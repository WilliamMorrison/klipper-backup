[include mainsail.cfg]
[include ebb.cfg]
[include cartographer.cfg]
[include KAMP_Settings.cfg]

[include macros/print_start.cfg]
[include macros/dragon_leds.cfg]

[include K-ShakeTune/*.cfg]


[gcode_arcs]
resolution: 0.1

[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_3D0054000A51313133353932-if00

restart_method: command

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 10000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0
 
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0 
position_endstop: 300
position_max: 300  
homing_speed: 25   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
##  Endstop connected to Y-ENDSTOP
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 25  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
##  Endstop connected to Z-ENDSTOP
[stepper_z]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD7 
rotation_distance: 4 
microsteps: 32 
endstop_pin: probe:z_virtual_endstop
position_max: 300
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z]
uart_pin: PD5
#diag_pin: ^!PD6
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: !PC11
enable_pin: !PD2
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z1]
uart_pin: PD0
#diag_pin: ^!PD1
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PC10
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z2]
uart_pin: PA8
#diag_pin: ^!PA15
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
##  SSR Pin - HEATBED
##  Thermistor - TH1
heater_pin: PG11
sensor_type: Generic 3950
sensor_pin: PA2
pullup_resistor: 2200
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[multi_pin fans]
pins: PF7,PF9

[fan_generic Electronics_Bay]
##  Controller fan - FAN2
pin=multi_pin:fans
##tachometer_pin: PF6
kick_start_time: 0.5
        


#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting (Optional)
## Connected to LED-STRIP
#[output_pin caselight]
#pin: PE6
#pwm:true
#hardware_pwm: False
#value: 0.20 #startup value
#shutdown_value: 0
#value:1
#cycle_time: 0.00025

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[safe_z_home]
home_xy_position: 150, 150
z_hop: 10

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead
z_positions:
  -50, 18
  150, 348
  350, 18
points:
  30, 5
  150, 245
  270, 5

speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075

[fan_generic Bento]
pin: PG10
cycle_time: 0.06



########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#####################################################################
#   Displays
#####################################################################



[display]
#  mini12864 LCD Display
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

[neopixel btt_mini12864]
#  To control Neopixel RGB in mini12864 display
pin: EXP1_6
chain_count: 3
initial_RED: 1
initial_GREEN: 1
initial_BLUE: 1
color_order: RGB

#  Set RGB values on boot up for each Neopixel. 
#  Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=2 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=3

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.024254, 0.019381, 0.012029, -0.000091, -0.007160, -0.014853, -0.014598, -0.012558, -0.006781, -0.001159, 0.003837, 0.004380, -0.000117, -0.009087, -0.015748, -0.022979, -0.027486, -0.027570, -0.024082, -0.016706, -0.008310, -0.000228, 0.010000, 0.018146, 0.024145
#*# 	  0.024431, 0.018984, 0.006906, -0.004275, -0.012540, -0.017335, -0.016488, -0.013275, -0.004702, -0.000409, 0.002625, 0.002183, -0.002750, -0.009620, -0.018834, -0.026977, -0.027865, -0.027081, -0.024145, -0.013784, -0.004965, 0.002124, 0.013543, 0.018867, 0.023432
#*# 	  0.023251, 0.019987, 0.007117, -0.002077, -0.010394, -0.015540, -0.016115, -0.013840, -0.006562, -0.000814, 0.005500, 0.004385, -0.000079, -0.006561, -0.014810, -0.022945, -0.026878, -0.027281, -0.023460, -0.015120, -0.005211, 0.003262, 0.012582, 0.019144, 0.023653
#*# 	  0.022000, 0.016662, 0.007157, -0.004843, -0.013833, -0.018187, -0.016962, -0.011524, -0.002735, 0.001818, 0.008861, 0.008051, 0.001493, -0.004873, -0.015554, -0.023085, -0.026249, -0.025185, -0.021943, -0.013285, -0.001387, 0.003778, 0.014859, 0.023244, 0.024988
#*# 	  0.020424, 0.019224, 0.008421, -0.004271, -0.010105, -0.015003, -0.016389, -0.011814, -0.003865, 0.004333, 0.012031, 0.013424, 0.007793, -0.000098, -0.010652, -0.018352, -0.022981, -0.023505, -0.022034, -0.014078, -0.004737, 0.004218, 0.016206, 0.022448, 0.026955
#*# 	  0.018468, 0.013189, 0.002881, -0.006830, -0.013948, -0.017792, -0.018237, -0.009366, -0.003000, 0.004540, 0.009606, 0.011068, 0.004339, -0.003040, -0.014474, -0.023047, -0.026815, -0.026359, -0.021477, -0.011668, -0.001288, 0.005566, 0.018795, 0.026656, 0.026291
#*# 	  0.015609, 0.013867, 0.004102, -0.007168, -0.013804, -0.018301, -0.018832, -0.013954, -0.005939, 0.001336, 0.007698, 0.008749, 0.003617, -0.003433, -0.013042, -0.022472, -0.027543, -0.025418, -0.024301, -0.014045, -0.001610, 0.006068, 0.017381, 0.026840, 0.031083
#*# 	  0.014448, 0.008863, -0.000309, -0.010011, -0.018410, -0.022096, -0.020705, -0.013750, -0.005552, 0.000448, 0.004976, 0.007849, 0.003208, -0.004362, -0.014366, -0.023290, -0.027471, -0.027414, -0.021478, -0.013228, -0.000124, 0.009284, 0.020473, 0.029356, 0.031014
#*# 	  0.014330, 0.014140, 0.002883, -0.008404, -0.015981, -0.020225, -0.021530, -0.016771, -0.009309, 0.000365, 0.006859, 0.008019, 0.003531, -0.004496, -0.011233, -0.020639, -0.022943, -0.023145, -0.021263, -0.014098, -0.001946, 0.007512, 0.019907, 0.028658, 0.033279
#*# 	  0.013266, 0.008451, 0.001804, -0.010554, -0.018601, -0.022983, -0.022116, -0.015018, -0.007549, -0.000039, 0.004407, 0.005259, -0.000849, -0.008086, -0.015833, -0.021692, -0.022759, -0.022636, -0.018287, -0.011377, 0.000538, 0.009116, 0.022570, 0.030628, 0.032276
#*# 	  0.012319, 0.011794, 0.003100, -0.008121, -0.014413, -0.021532, -0.022009, -0.018693, -0.010750, -0.002525, 0.004205, 0.004311, 0.000000, -0.007537, -0.013282, -0.018340, -0.019428, -0.020535, -0.018402, -0.010766, -0.000213, 0.009034, 0.021168, 0.031253, 0.035878
#*# 	  0.008921, 0.008589, -0.000428, -0.010716, -0.018571, -0.023435, -0.022971, -0.016541, -0.009173, -0.004539, 0.003741, 0.003315, -0.001384, -0.008999, -0.015164, -0.018403, -0.018838, -0.019734, -0.017760, -0.009382, 0.001497, 0.009427, 0.022629, 0.031877, 0.032944
#*# 	  0.008290, 0.007880, -0.000975, -0.009401, -0.018933, -0.025243, -0.025313, -0.020548, -0.012170, -0.004144, 0.004173, 0.005668, 0.001145, -0.003712, -0.013456, -0.018144, -0.018981, -0.020977, -0.018547, -0.011500, 0.000304, 0.009320, 0.022609, 0.032334, 0.037568
#*# 	  0.007922, 0.002085, -0.005999, -0.014979, -0.023081, -0.027514, -0.026262, -0.021181, -0.009205, -0.003694, 0.003204, 0.004355, -0.000203, -0.007318, -0.014294, -0.020389, -0.022500, -0.022553, -0.019467, -0.010015, 0.002311, 0.013508, 0.026389, 0.033415, 0.033415
#*# 	  0.004878, 0.002680, -0.008305, -0.016114, -0.023251, -0.027995, -0.028037, -0.022927, -0.014343, -0.007348, -0.000855, 0.003114, -0.001213, -0.004704, -0.012532, -0.022344, -0.023498, -0.025910, -0.023022, -0.013405, -0.000382, 0.009055, 0.022020, 0.031318, 0.034527
#*# 	  0.002031, -0.001862, -0.014220, -0.022845, -0.027632, -0.032171, -0.031711, -0.025254, -0.017016, -0.009759, -0.003855, 0.001700, -0.003422, -0.006421, -0.014409, -0.024849, -0.028223, -0.030380, -0.023819, -0.013254, 0.000727, 0.009348, 0.023199, 0.030945, 0.031324
#*# 	  0.000537, -0.001110, -0.012986, -0.021310, -0.030972, -0.034260, -0.033522, -0.030414, -0.022877, -0.015142, -0.006207, -0.003471, -0.004221, -0.008334, -0.014838, -0.026271, -0.032118, -0.032190, -0.027809, -0.017578, -0.001596, 0.007918, 0.017942, 0.028325, 0.031765
#*# 	  -0.004809, -0.010162, -0.020650, -0.031175, -0.036954, -0.041347, -0.038286, -0.032138, -0.023251, -0.014398, -0.009695, -0.006649, -0.009917, -0.013566, -0.019733, -0.029345, -0.030156, -0.028787, -0.022498, -0.009040, 0.004150, 0.016273, 0.027072, 0.032704, 0.032017
#*# 	  -0.007691, -0.011108, -0.022550, -0.031730, -0.041099, -0.043745, -0.042344, -0.037369, -0.028949, -0.018692, -0.010656, -0.007379, -0.006187, -0.009474, -0.016111, -0.022474, -0.023413, -0.020980, -0.014010, -0.000392, 0.015669, 0.027570, 0.040060, 0.049046, 0.053290
#*# 	  -0.011267, -0.014714, -0.028419, -0.035244, -0.042264, -0.044147, -0.041232, -0.034167, -0.026043, -0.017213, -0.009243, -0.005989, -0.004804, -0.006422, -0.015548, -0.022821, -0.022185, -0.018283, -0.011242, 0.006181, 0.020316, 0.031673, 0.043336, 0.050615, 0.052612
#*# 	  -0.013197, -0.013886, -0.023534, -0.031234, -0.041276, -0.044499, -0.045095, -0.037176, -0.028574, -0.017425, -0.010764, -0.006887, -0.007926, -0.008328, -0.015534, -0.020492, -0.023842, -0.021836, -0.014100, -0.000886, 0.013400, 0.026110, 0.038515, 0.044829, 0.048398
#*# x_count = 25
#*# y_count = 21
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 88.0
#*# max_x = 212.0
#*# min_y = 103.0
#*# max_y = 197.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.776
#*# pid_ki = 1.500
#*# pid_kd = 52.661
#*#
#*# [cartographer model default]
#*# model_coef = 1.5419518094452889,
#*# 	1.9666003021210665,
#*# 	0.7515077779130777,
#*# 	0.3529275020481013,
#*# 	0.21849575890509604,
#*# 	0.11081038193531592,
#*# 	-0.056114562608773934,
#*# 	-0.022235016282389893,
#*# 	0.0957918191517678,
#*# 	0.04615726316309864
#*# model_domain = 3.3007487381470957e-07,3.3517720376049316e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 32.866226
#*# model_offset = 0.10000
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 36.322
#*# pid_ki = 1.248
#*# pid_kd = 264.240
