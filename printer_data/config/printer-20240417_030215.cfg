[include mainsail.cfg]
[include ebb.cfg]
[include cartographer.cfg]
[include KAMP_Settings.cfg]

[include macros/print_start.cfg]
[include macros/dragon_leds.cfg]


[gcode_arcs]
resolution: 0.1

[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_3D0054000A51313133353932-if00

restart_method: command

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 10000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0
 
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0 
position_endstop: 300
position_max: 300  
homing_speed: 25   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
##  Endstop connected to Y-ENDSTOP
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 25  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
##  Endstop connected to Z-ENDSTOP
[stepper_z]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD7 
rotation_distance: 4 
microsteps: 32 
endstop_pin: probe:z_virtual_endstop
position_max: 300
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z]
uart_pin: PD5
#diag_pin: ^!PD6
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: !PC11
enable_pin: !PD2
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z1]
uart_pin: PD0
#diag_pin: ^!PD1
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PC10
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z2]
uart_pin: PA8
#diag_pin: ^!PA15
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
##  SSR Pin - HEATBED
##  Thermistor - TH1
heater_pin: PG11
sensor_type: Generic 3950
sensor_pin: PA2
pullup_resistor: 2200
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[controller_fan controller_fan]
##  Controller fan - FAN2
pin: PF7
##tachometer_pin: PF6
kick_start_time: 0.5
heater: heater_bed


#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting (Optional)
## Connected to LED-STRIP
#[output_pin caselight]
#pin: PE6
#pwm:true
#hardware_pwm: False
#value: 0.20 #startup value
#shutdown_value: 0
#value:1
#cycle_time: 0.00025

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[safe_z_home]
home_xy_position: 150, 150
z_hop: 10

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead
z_positions:
  -50, 18
  150, 348
  350, 18
points:
  30, 5
  150, 245
  270, 5

speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#####################################################################
#   Displays
#####################################################################



[display]
#  mini12864 LCD Display
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

[neopixel btt_mini12864]
#  To control Neopixel RGB in mini12864 display
pin: EXP1_6
chain_count: 3
initial_RED: 1
initial_GREEN: 1
initial_BLUE: 1
color_order: RGB

#  Set RGB values on boot up for each Neopixel. 
#  Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=2 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=3 




#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.008138, 0.006504, 0.002905, -0.004875, -0.013063, -0.018228, -0.022570, -0.024449, -0.025349, -0.022689, -0.018301, -0.014407, -0.011764, -0.008244, -0.008267, -0.013750, -0.014845, -0.020301, -0.026753, -0.029038, -0.031123, -0.031093, -0.027695, -0.025956, -0.019000, -0.013052, -0.006897, 0.002401, 0.007898, 0.012142
#*# 	  0.009229, 0.007890, 0.002604, -0.006323, -0.014048, -0.018369, -0.024806, -0.025056, -0.024291, -0.022668, -0.017950, -0.013867, -0.012063, -0.009553, -0.011943, -0.016217, -0.018473, -0.024126, -0.027778, -0.030374, -0.031593, -0.029855, -0.029902, -0.022666, -0.016503, -0.011537, -0.001539, 0.004821, 0.008992, 0.013565
#*# 	  0.010816, 0.010074, 0.004959, -0.003041, -0.012678, -0.018477, -0.022698, -0.026362, -0.023564, -0.021443, -0.018026, -0.014272, -0.012733, -0.011300, -0.012272, -0.014475, -0.017318, -0.022554, -0.027073, -0.031061, -0.031928, -0.032363, -0.028940, -0.024958, -0.019063, -0.011694, -0.005872, 0.000915, 0.008003, 0.012350
#*# 	  0.010476, 0.008805, 0.002559, -0.005397, -0.011697, -0.018337, -0.022777, -0.023578, -0.022646, -0.019908, -0.014686, -0.010292, -0.009094, -0.007667, -0.009567, -0.013896, -0.018403, -0.023087, -0.027474, -0.031529, -0.031581, -0.031398, -0.028830, -0.020306, -0.014680, -0.009453, -0.002649, 0.006274, 0.008286, 0.014065
#*# 	  0.012620, 0.011777, 0.007084, -0.000896, -0.010501, -0.016690, -0.022258, -0.023861, -0.022682, -0.019306, -0.015872, -0.011281, -0.008647, -0.005994, -0.006879, -0.009467, -0.015526, -0.021486, -0.028253, -0.031256, -0.031529, -0.031519, -0.028810, -0.024010, -0.016081, -0.011014, -0.005661, 0.002936, 0.009654, 0.011559
#*# 	  0.011971, 0.008696, 0.003366, -0.003582, -0.011491, -0.018397, -0.021928, -0.023507, -0.022495, -0.018153, -0.013201, -0.009187, -0.006528, -0.005094, -0.005982, -0.010946, -0.016784, -0.022830, -0.027829, -0.031231, -0.031506, -0.029775, -0.026742, -0.019042, -0.013807, -0.009415, -0.000863, 0.007244, 0.009042, 0.014909
#*# 	  0.009126, 0.009280, 0.005998, -0.001564, -0.011601, -0.018681, -0.022419, -0.024762, -0.023305, -0.018990, -0.014278, -0.010721, -0.008152, -0.005939, -0.006522, -0.009045, -0.013745, -0.019900, -0.025831, -0.028618, -0.031512, -0.030393, -0.027767, -0.023572, -0.015970, -0.009705, -0.004305, 0.003553, 0.010618, 0.012381
#*# 	  0.009645, 0.007797, 0.002185, -0.005922, -0.013911, -0.018605, -0.023269, -0.023857, -0.022240, -0.017860, -0.012070, -0.007344, -0.003621, -0.000719, -0.003927, -0.008926, -0.013893, -0.019168, -0.024641, -0.027760, -0.029522, -0.028292, -0.028244, -0.019594, -0.012691, -0.008722, 0.001366, 0.007041, 0.010407, 0.016167
#*# 	  0.008836, 0.008128, 0.003930, -0.003825, -0.013304, -0.018659, -0.023490, -0.026627, -0.023283, -0.018467, -0.013609, -0.009288, -0.003940, 0.000508, -0.001102, -0.005079, -0.009664, -0.017859, -0.023151, -0.028836, -0.031352, -0.030351, -0.029315, -0.022841, -0.014490, -0.008467, -0.002633, 0.005838, 0.012338, 0.015568
#*# 	  0.008844, 0.006943, 0.000378, -0.006497, -0.014609, -0.020085, -0.024112, -0.025125, -0.021639, -0.016344, -0.010251, -0.005834, -0.000633, 0.002235, -0.000213, -0.005557, -0.010983, -0.018356, -0.023498, -0.029068, -0.028024, -0.029590, -0.026564, -0.018121, -0.012710, -0.006934, 0.003862, 0.010559, 0.013530, 0.017646
#*# 	  0.007790, 0.007185, 0.003391, -0.005073, -0.014093, -0.021779, -0.023980, -0.027079, -0.024483, -0.018470, -0.013196, -0.007685, -0.001529, 0.001141, 0.001153, -0.001945, -0.006934, -0.014267, -0.023973, -0.027254, -0.029929, -0.030264, -0.027633, -0.022435, -0.015936, -0.008391, -0.002143, 0.006145, 0.014077, 0.016767
#*# 	  0.007196, 0.003668, -0.000886, -0.009237, -0.016386, -0.022959, -0.026394, -0.026843, -0.022361, -0.017916, -0.011027, -0.004733, 0.000378, 0.002568, 0.001384, -0.001219, -0.008659, -0.014074, -0.020027, -0.027501, -0.027999, -0.027367, -0.026944, -0.018945, -0.011096, -0.006271, 0.004446, 0.012583, 0.014860, 0.018382
#*# 	  0.005364, 0.004285, 0.001634, -0.006285, -0.015641, -0.021799, -0.024605, -0.026768, -0.025771, -0.019703, -0.013506, -0.005736, -0.000893, 0.002036, 0.002468, -0.002878, -0.006285, -0.013479, -0.019073, -0.024873, -0.027765, -0.027104, -0.027101, -0.022797, -0.014311, -0.007829, 0.000171, 0.011259, 0.016670, 0.021005
#*# 	  0.005080, 0.004030, -0.000820, -0.009589, -0.015334, -0.023098, -0.025331, -0.025182, -0.022523, -0.016581, -0.010329, -0.004378, -0.000402, 0.001848, -0.000801, -0.005438, -0.009783, -0.015760, -0.021909, -0.026815, -0.027095, -0.026265, -0.024335, -0.017730, -0.009450, -0.005675, 0.006814, 0.013558, 0.017398, 0.022561
#*# 	  0.003915, 0.003300, -0.000733, -0.006268, -0.014127, -0.020915, -0.024613, -0.025841, -0.024089, -0.018450, -0.012988, -0.005979, -0.001309, 0.000990, 0.001517, -0.003829, -0.009446, -0.014688, -0.019096, -0.022568, -0.025845, -0.025336, -0.022895, -0.019915, -0.013971, -0.005294, 0.002211, 0.012105, 0.020194, 0.023518
#*# 	  0.004480, 0.003545, -0.001891, -0.010732, -0.015102, -0.021934, -0.026091, -0.026005, -0.022440, -0.016056, -0.012159, -0.004262, -0.001112, 0.000451, -0.000742, -0.005353, -0.010649, -0.015106, -0.019691, -0.024178, -0.026679, -0.023701, -0.022378, -0.016643, -0.008200, -0.004992, 0.007569, 0.016733, 0.019185, 0.024198
#*# 	  0.003293, 0.000736, -0.000832, -0.008815, -0.016237, -0.022379, -0.026672, -0.027100, -0.026081, -0.020482, -0.013795, -0.008715, -0.003047, 0.001368, -0.000631, -0.005065, -0.009462, -0.013856, -0.019040, -0.023911, -0.026680, -0.025372, -0.022890, -0.019013, -0.011725, -0.005270, 0.003297, 0.015095, 0.020962, 0.023650
#*# 	  0.001078, -0.000650, -0.005220, -0.013123, -0.020348, -0.026818, -0.029799, -0.029106, -0.026302, -0.020328, -0.013662, -0.007372, -0.003598, -0.000153, -0.001956, -0.005119, -0.011107, -0.015803, -0.021604, -0.027102, -0.028552, -0.026263, -0.024273, -0.016171, -0.009028, -0.002689, 0.008174, 0.016869, 0.019917, 0.025088
#*# 	  0.000730, -0.002631, -0.004887, -0.011935, -0.020643, -0.026878, -0.028293, -0.031197, -0.029529, -0.023088, -0.017047, -0.011969, -0.006031, -0.001151, -0.001533, -0.004765, -0.009454, -0.014784, -0.020606, -0.026030, -0.027098, -0.027502, -0.025406, -0.020331, -0.013458, -0.005139, 0.003967, 0.015904, 0.020962, 0.024780
#*# 	  -0.000774, -0.003935, -0.009568, -0.018308, -0.023784, -0.029330, -0.032693, -0.033180, -0.029948, -0.024532, -0.017861, -0.012090, -0.006329, -0.003511, -0.003311, -0.007749, -0.012790, -0.016281, -0.022944, -0.028405, -0.031252, -0.029383, -0.026478, -0.017485, -0.008219, -0.001986, 0.007701, 0.016783, 0.019318, 0.022984
#*# 	  -0.002574, -0.004717, -0.009442, -0.016045, -0.023570, -0.030591, -0.033571, -0.035313, -0.032836, -0.028454, -0.022781, -0.017475, -0.011481, -0.005190, -0.001968, -0.005500, -0.010291, -0.016333, -0.022760, -0.028335, -0.031903, -0.031639, -0.028694, -0.021142, -0.013055, -0.002091, 0.005156, 0.016049, 0.020869, 0.023789
#*# 	  -0.003415, -0.006215, -0.012707, -0.019772, -0.027579, -0.034220, -0.036056, -0.037869, -0.033562, -0.028952, -0.022628, -0.018216, -0.013841, -0.008518, -0.006328, -0.006459, -0.010913, -0.018422, -0.027513, -0.034792, -0.035947, -0.031832, -0.027793, -0.018471, -0.005266, -0.000508, 0.009667, 0.016879, 0.018231, 0.023233
#*# 	  -0.001496, -0.007631, -0.010188, -0.019094, -0.026994, -0.032094, -0.035936, -0.037398, -0.036368, -0.033142, -0.027205, -0.019768, -0.017447, -0.011944, -0.009476, -0.009469, -0.013020, -0.018228, -0.027009, -0.031527, -0.035650, -0.032814, -0.029729, -0.022284, -0.010577, -0.002484, 0.004727, 0.016201, 0.020961, 0.022977
#*# 	  -0.003091, -0.008281, -0.014520, -0.022749, -0.030700, -0.035689, -0.037201, -0.038772, -0.036061, -0.031991, -0.027033, -0.019985, -0.015076, -0.013358, -0.009551, -0.011394, -0.014552, -0.022424, -0.028522, -0.035949, -0.035988, -0.034495, -0.026946, -0.016510, -0.004801, 0.002475, 0.010273, 0.017469, 0.017924, 0.022583
#*# 	  -0.001231, -0.007215, -0.012409, -0.020125, -0.027489, -0.035006, -0.038515, -0.040382, -0.040151, -0.035972, -0.030382, -0.024620, -0.017998, -0.014293, -0.010733, -0.012805, -0.017162, -0.022411, -0.030261, -0.035506, -0.035945, -0.035115, -0.029861, -0.021198, -0.010109, -0.000876, 0.007318, 0.016143, 0.021042, 0.021900
#*# 	  -0.002899, -0.007265, -0.014599, -0.023146, -0.030367, -0.036499, -0.040389, -0.040658, -0.038303, -0.034614, -0.028153, -0.024109, -0.018214, -0.014261, -0.013265, -0.013610, -0.018278, -0.024459, -0.030774, -0.036577, -0.035947, -0.032205, -0.026329, -0.013544, -0.002990, 0.002707, 0.010110, 0.017063, 0.019302, 0.020393
#*# 	  -0.003370, -0.008338, -0.012663, -0.021038, -0.028742, -0.035094, -0.038512, -0.041283, -0.040356, -0.035555, -0.029800, -0.026545, -0.018979, -0.013052, -0.011741, -0.012110, -0.017136, -0.022742, -0.030473, -0.032474, -0.034610, -0.031829, -0.027670, -0.020365, -0.009671, 0.000188, 0.008777, 0.016681, 0.022977, 0.024648
#*# 	  -0.002919, -0.005445, -0.014075, -0.022729, -0.029887, -0.035976, -0.039417, -0.040217, -0.036502, -0.032565, -0.026784, -0.022427, -0.016065, -0.013620, -0.011368, -0.013045, -0.016078, -0.023215, -0.029257, -0.034823, -0.034111, -0.031502, -0.023494, -0.013077, -0.002884, 0.003802, 0.010332, 0.020807, 0.019677, 0.022915
#*# 	  -0.002703, -0.007675, -0.011321, -0.020863, -0.027445, -0.032137, -0.036341, -0.037997, -0.037420, -0.034531, -0.027551, -0.021162, -0.014271, -0.009888, -0.009422, -0.013044, -0.016463, -0.021438, -0.028659, -0.031503, -0.032759, -0.031517, -0.026282, -0.019102, -0.009574, -0.000843, 0.007759, 0.017868, 0.022974, 0.023880
#*# 	  -0.001270, -0.005362, -0.011313, -0.020509, -0.027310, -0.035031, -0.036299, -0.035948, -0.033178, -0.029716, -0.023494, -0.018244, -0.012614, -0.010299, -0.008616, -0.009705, -0.013998, -0.022731, -0.027652, -0.032482, -0.033215, -0.029830, -0.023571, -0.014638, -0.003958, 0.001063, 0.008639, 0.016295, 0.019109, 0.024485
#*# 	  0.000486, -0.006750, -0.009450, -0.017791, -0.025321, -0.031272, -0.033961, -0.035899, -0.035240, -0.031538, -0.026238, -0.019208, -0.011993, -0.009058, -0.007752, -0.011393, -0.013785, -0.022174, -0.026857, -0.030441, -0.031520, -0.029028, -0.025436, -0.020753, -0.010514, -0.002214, 0.007205, 0.015376, 0.020976, 0.024655
#*# x_count = 30
#*# y_count = 31
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 88.0
#*# max_x = 212.0
#*# min_y = 87.0
#*# max_y = 213.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.776
#*# pid_ki = 1.500
#*# pid_kd = 52.661
#*#
#*# [cartographer model default]
#*# model_coef = 1.5419518094452889,
#*# 	  1.9666003021210665,
#*# 	  0.7515077779130777,
#*# 	  0.3529275020481013,
#*# 	  0.21849575890509604,
#*# 	  0.11081038193531592,
#*# 	  -0.056114562608773934,
#*# 	  -0.022235016282389893,
#*# 	  0.0957918191517678,
#*# 	  0.04615726316309864
#*# model_domain = 3.3007487381470957e-07,3.3517720376049316e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 32.866226
#*# model_offset = -0.05000
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 36.322
#*# pid_ki = 1.248
#*# pid_kd = 264.240
