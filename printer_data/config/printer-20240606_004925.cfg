[include mainsail.cfg]
[include ebb.cfg]
[include cartographer.cfg]
[include KAMP_Settings.cfg]

[include macros/print_start.cfg]
[include macros/dragon_leds.cfg]

[include K-ShakeTune/*.cfg]


[gcode_arcs]
resolution: 0.1

[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_3D0054000A51313133353932-if00

restart_method: command

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 10000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0
 
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0 
position_endstop: 300
position_max: 300  
homing_speed: 25   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
##  Endstop connected to Y-ENDSTOP
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 25  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
##  Endstop connected to Z-ENDSTOP
[stepper_z]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD7 
rotation_distance: 4 
microsteps: 32 
endstop_pin: probe:z_virtual_endstop
position_max: 300
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z]
uart_pin: PD5
#diag_pin: ^!PD6
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: !PC11
enable_pin: !PD2
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z1]
uart_pin: PD0
#diag_pin: ^!PD1
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PC10
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z2]
uart_pin: PA8
#diag_pin: ^!PA15
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: Generic 3950
sensor_pin: PA2
pullup_resistor: 2200
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[multi_pin fans]
pins: PF7,PF9

[fan_generic Electronics_Bay]
##  Controller fan - FAN2
pin=multi_pin:fans
##tachometer_pin: PF6
kick_start_time: 0.5
        


#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting (Optional)
## Connected to LED-STRIP
#[output_pin caselight]
#pin: PE6
#pwm:true
#hardware_pwm: False
#value: 0.20 #startup value
#shutdown_value: 0
#value:1
#cycle_time: 0.00025

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[safe_z_home]
home_xy_position: 150, 150
z_hop: 10

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead
z_positions:
  -50, 18
  150, 348
  350, 18
points:
  30, 5
  150, 245
  270, 5

speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075

[fan_generic Bento]
pin: PG10
cycle_time: 0.06



########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#####################################################################
#   Displays
#####################################################################



[display]
#  mini12864 LCD Display
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

[neopixel btt_mini12864]
#  To control Neopixel RGB in mini12864 display
pin: EXP1_6
chain_count: 3
initial_RED: 1
initial_GREEN: 1
initial_BLUE: 1
color_order: RGB

#  Set RGB values on boot up for each Neopixel. 
#  Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=2 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=3

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.005871, 0.001127, -0.005583, -0.016050, -0.022757, -0.027003, -0.024686, -0.020088, -0.012776, -0.008005, -0.002987, -0.001496, -0.005637, -0.011313, -0.020077, -0.023879, -0.023772, -0.020276, -0.016372, -0.003488, 0.005563, 0.011996, 0.022329, 0.028276, 0.031663
#*# 	  0.005525, 0.000017, -0.011342, -0.019167, -0.027406, -0.028543, -0.025835, -0.019287, -0.011777, -0.006658, -0.004253, -0.003276, -0.007582, -0.013859, -0.021709, -0.022796, -0.022703, -0.016965, -0.011102, -0.000066, 0.007426, 0.015048, 0.025717, 0.029958, 0.033860
#*# 	  0.005793, 0.000866, -0.008941, -0.016921, -0.024188, -0.028426, -0.027815, -0.022428, -0.014045, -0.007447, -0.002170, -0.000101, -0.004631, -0.009641, -0.016881, -0.020239, -0.022777, -0.018520, -0.013237, -0.004246, 0.004869, 0.011465, 0.022505, 0.028407, 0.032561
#*# 	  0.003751, -0.004019, -0.011757, -0.021309, -0.025678, -0.028562, -0.026581, -0.019476, -0.010145, -0.002705, 0.001745, 0.000101, -0.003098, -0.008183, -0.017159, -0.021622, -0.021262, -0.017396, -0.013101, -0.002198, 0.009211, 0.016183, 0.028414, 0.030724, 0.034336
#*# 	  0.003393, -0.000971, -0.010145, -0.019729, -0.026022, -0.028512, -0.028519, -0.018690, -0.009739, -0.001505, 0.004987, 0.005791, -0.000965, -0.005582, -0.013798, -0.020333, -0.022252, -0.021626, -0.012861, -0.005794, 0.005558, 0.012961, 0.025135, 0.033155, 0.034883
#*# 	  0.000082, -0.005640, -0.014915, -0.022799, -0.028195, -0.028551, -0.025613, -0.018037, -0.008467, -0.000956, 0.003362, 0.005643, -0.001061, -0.005860, -0.017061, -0.021258, -0.022419, -0.020262, -0.012359, -0.003224, 0.011473, 0.018852, 0.029362, 0.034177, 0.038823
#*# 	  0.000107, -0.004717, -0.010537, -0.017747, -0.025638, -0.029292, -0.027101, -0.022084, -0.011421, -0.003458, 0.004284, 0.006148, 0.003112, -0.004293, -0.012718, -0.019749, -0.022062, -0.019996, -0.017050, -0.004208, 0.005640, 0.016228, 0.028237, 0.034613, 0.038959
#*# 	  -0.000204, -0.008289, -0.017329, -0.026275, -0.029149, -0.032276, -0.027152, -0.020394, -0.010691, -0.001314, 0.005840, 0.006857, 0.003109, -0.005095, -0.011838, -0.018650, -0.019524, -0.017067, -0.011279, 0.000168, 0.011485, 0.018261, 0.034304, 0.038205, 0.042516
#*# 	  -0.000207, -0.005392, -0.011295, -0.022454, -0.029616, -0.030886, -0.028610, -0.018138, -0.011686, -0.001089, 0.004117, 0.006192, 0.000442, -0.003790, -0.011051, -0.016869, -0.017561, -0.017115, -0.013465, -0.005659, 0.008958, 0.016669, 0.030356, 0.037313, 0.039958
#*# 	  -0.005047, -0.006528, -0.014975, -0.023239, -0.029130, -0.031896, -0.027646, -0.020377, -0.007758, -0.002232, 0.005788, 0.004817, -0.002483, -0.006417, -0.012042, -0.017016, -0.017561, -0.015490, -0.011203, 0.000209, 0.011150, 0.022844, 0.035070, 0.039746, 0.042923
#*# 	  -0.004876, -0.005603, -0.011278, -0.021751, -0.027460, -0.031941, -0.028754, -0.021694, -0.011389, -0.003136, 0.003115, 0.005593, -0.000000, -0.005619, -0.011337, -0.016497, -0.017070, -0.017047, -0.012145, -0.005644, 0.007179, 0.019126, 0.030024, 0.038909, 0.041301
#*# 	  -0.005811, -0.007286, -0.017105, -0.023407, -0.029702, -0.032725, -0.027943, -0.016853, -0.009580, -0.001312, 0.004160, 0.003571, -0.000850, -0.007208, -0.012378, -0.013913, -0.017039, -0.016312, -0.011235, -0.000862, 0.011507, 0.023241, 0.035353, 0.039738, 0.044704
#*# 	  -0.006443, -0.007929, -0.016793, -0.024330, -0.031962, -0.033928, -0.030811, -0.022791, -0.011612, -0.005652, 0.004361, 0.002425, 0.000112, -0.007197, -0.011836, -0.017027, -0.019240, -0.017124, -0.014578, -0.005655, 0.007901, 0.019556, 0.031421, 0.039677, 0.044454
#*# 	  -0.009419, -0.013913, -0.022788, -0.028708, -0.034286, -0.034660, -0.031388, -0.020887, -0.010904, -0.005455, 0.003045, 0.001512, -0.002616, -0.007916, -0.014973, -0.018447, -0.021010, -0.018163, -0.013784, -0.000274, 0.011786, 0.023743, 0.034661, 0.039780, 0.041849
#*# 	  -0.009423, -0.011987, -0.021606, -0.028482, -0.033785, -0.034671, -0.033594, -0.023104, -0.015969, -0.007146, -0.003360, 0.001240, 0.000106, -0.007039, -0.013503, -0.020507, -0.022782, -0.019893, -0.016481, -0.003171, 0.011224, 0.018549, 0.033298, 0.040230, 0.041327
#*# 	  -0.012689, -0.017913, -0.025379, -0.031433, -0.037646, -0.036653, -0.034297, -0.026976, -0.016883, -0.007980, -0.002647, 0.000106, -0.002870, -0.006106, -0.017184, -0.023076, -0.024451, -0.022302, -0.016123, 0.000463, 0.012133, 0.023322, 0.034529, 0.038228, 0.042405
#*# 	  -0.012306, -0.014200, -0.023262, -0.032827, -0.039500, -0.040088, -0.037000, -0.030001, -0.023259, -0.012119, -0.006215, -0.001748, -0.002608, -0.008103, -0.014348, -0.023500, -0.028252, -0.023338, -0.018402, -0.003741, 0.011121, 0.021928, 0.033461, 0.039639, 0.040500
#*# 	  -0.013887, -0.018513, -0.028578, -0.037220, -0.040307, -0.040219, -0.037156, -0.031137, -0.022648, -0.014151, -0.008124, -0.005597, -0.008415, -0.011808, -0.021715, -0.025104, -0.027200, -0.023107, -0.015883, 0.001989, 0.015723, 0.024395, 0.034187, 0.038641, 0.042423
#*# 	  -0.011837, -0.014263, -0.026734, -0.033502, -0.039933, -0.041674, -0.040087, -0.034403, -0.024946, -0.017641, -0.007109, -0.006186, -0.007111, -0.011624, -0.020448, -0.025458, -0.028518, -0.023962, -0.017511, -0.002079, 0.011273, 0.022677, 0.033490, 0.039618, 0.041381
#*# 	  -0.012954, -0.017959, -0.028187, -0.034414, -0.041278, -0.043641, -0.040634, -0.033979, -0.026732, -0.016564, -0.009579, -0.007398, -0.008504, -0.012973, -0.022851, -0.026910, -0.026468, -0.022520, -0.012558, 0.001191, 0.017179, 0.028445, 0.035323, 0.039724, 0.041240
#*# 	  -0.011361, -0.012438, -0.024125, -0.031790, -0.041054, -0.042733, -0.040222, -0.034445, -0.027098, -0.017632, -0.011376, -0.007134, -0.007176, -0.011353, -0.020621, -0.025225, -0.025912, -0.022790, -0.017093, -0.000460, 0.011445, 0.023491, 0.034087, 0.039691, 0.042112
#*# x_count = 25
#*# y_count = 21
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 88.0
#*# max_x = 212.0
#*# min_y = 103.0
#*# max_y = 197.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.776
#*# pid_ki = 1.500
#*# pid_kd = 52.661
#*#
#*# [cartographer model default]
#*# model_coef = 1.5542568462164812,
#*# 	  1.9860298020279998,
#*# 	  0.7329735017977707,
#*# 	  0.299381890114666,
#*# 	  0.2794438533646995,
#*# 	  0.24761856781620242,
#*# 	  -0.16883010258510842,
#*# 	  -0.1950487392153785,
#*# 	  0.15377172119165913,
#*# 	  0.11612911944525266
#*# model_domain = 3.308099569842108e-07,3.35427909844388e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 54.607031
#*# model_offset = 0.00000
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 36.322
#*# pid_ki = 1.248
#*# pid_kd = 264.240
