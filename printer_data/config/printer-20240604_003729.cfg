[include mainsail.cfg]
[include ebb.cfg]
[include cartographer.cfg]
[include KAMP_Settings.cfg]

[include macros/print_start.cfg]
[include macros/dragon_leds.cfg]

[include K-ShakeTune/*.cfg]


[gcode_arcs]
resolution: 0.1

[exclude_object]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_3D0054000A51313133353932-if00

restart_method: command

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 10000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0
 
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0 
position_endstop: 300
position_max: 300  
homing_speed: 25   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
##  Endstop connected to Y-ENDSTOP
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 200 for 1.8 degree stepper
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 25  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
interpolate: False
run_current: 1.25
sense_resistor: 0.075
stealthchop_threshold: 0
driver_SGT: 3
driver_TBL: 1
driver_TOFF: 3
driver_HSTRT: 0
driver_HEND: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
##  Endstop connected to Z-ENDSTOP
[stepper_z]
step_pin: PD4
dir_pin: !PD3
enable_pin: !PD7 
rotation_distance: 4 
microsteps: 32 
endstop_pin: probe:z_virtual_endstop
position_max: 300
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z]
uart_pin: PD5
#diag_pin: ^!PD6
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: !PC11
enable_pin: !PD2
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z1]
uart_pin: PD0
#diag_pin: ^!PD1
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PC10
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##  Make sure to update below for your relevant driver (2209 or 5160)
[tmc2209 stepper_z2]
uart_pin: PA8
#diag_pin: ^!PA15
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 999999

#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: Generic 3950
sensor_pin: PA2
pullup_resistor: 2200
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[multi_pin fans]
pins: PF7,PF9

[fan_generic Electronics_Bay]
##  Controller fan - FAN2
pin=multi_pin:fans
##tachometer_pin: PF6
kick_start_time: 0.5
        


#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting (Optional)
## Connected to LED-STRIP
#[output_pin caselight]
#pin: PE6
#pwm:true
#hardware_pwm: False
#value: 0.20 #startup value
#shutdown_value: 0
#value:1
#cycle_time: 0.00025

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[safe_z_home]
home_xy_position: 150, 150
z_hop: 10

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead
z_positions:
  -50, 18
  150, 348
  350, 18
points:
  30, 5
  150, 245
  270, 5

speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075

[fan_generic Bento]
pin: PG10
cycle_time: 0.06



########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#####################################################################
#   Displays
#####################################################################



[display]
#  mini12864 LCD Display
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

[neopixel btt_mini12864]
#  To control Neopixel RGB in mini12864 display
pin: EXP1_6
chain_count: 3
initial_RED: 1
initial_GREEN: 1
initial_BLUE: 1
color_order: RGB

#  Set RGB values on boot up for each Neopixel. 
#  Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=2 TRANSMIT=0
       SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=3

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.024136, 0.019761, 0.012226, 0.000155, -0.006575, -0.012381, -0.012692, -0.009308, -0.002954, 0.003913, 0.007865, 0.008200, 0.004324, -0.004419, -0.012860, -0.018335, -0.019911, -0.016575, -0.012340, -0.005418, 0.007529, 0.014813, 0.021948, 0.029662, 0.033066
#*# 	  0.023536, 0.018091, 0.008729, -0.002457, -0.010233, -0.013228, -0.012165, -0.007590, -0.000507, 0.004326, 0.008214, 0.008610, 0.002870, -0.005413, -0.013233, -0.017324, -0.017147, -0.014642, -0.009037, 0.000002, 0.009261, 0.016446, 0.024737, 0.030854, 0.033206
#*# 	  0.024429, 0.018907, 0.010049, -0.000226, -0.011111, -0.012558, -0.014723, -0.010433, -0.003256, 0.002944, 0.008555, 0.008886, 0.004330, -0.000528, -0.009684, -0.015051, -0.018003, -0.015088, -0.010585, -0.005084, 0.005089, 0.011833, 0.022180, 0.028700, 0.032423
#*# 	  0.021613, 0.015288, 0.005654, -0.002346, -0.010310, -0.014166, -0.014938, -0.009070, -0.000824, 0.004553, 0.009230, 0.009088, 0.003305, -0.004158, -0.012068, -0.015863, -0.018188, -0.015066, -0.010170, -0.003719, 0.006000, 0.013540, 0.023960, 0.028948, 0.032687
#*# 	  0.019418, 0.016795, 0.009221, -0.000493, -0.010516, -0.015063, -0.015239, -0.010779, -0.002126, 0.004141, 0.010279, 0.012660, 0.005818, 0.000432, -0.006574, -0.012598, -0.016447, -0.019013, -0.013867, -0.006159, 0.003905, 0.012752, 0.023143, 0.028347, 0.034032
#*# 	  0.016886, 0.010921, 0.002481, -0.005903, -0.012209, -0.016996, -0.015979, -0.008261, 0.000860, 0.006179, 0.011034, 0.011982, 0.005140, -0.002842, -0.009922, -0.016168, -0.019889, -0.018951, -0.013241, -0.003749, 0.006900, 0.015326, 0.025935, 0.032690, 0.035746
#*# 	  0.014910, 0.011407, 0.001618, -0.006148, -0.012841, -0.018643, -0.019699, -0.012351, -0.005399, 0.003698, 0.009278, 0.012942, 0.006589, -0.000390, -0.006269, -0.015049, -0.018866, -0.018560, -0.015578, -0.007673, 0.005980, 0.013647, 0.026472, 0.032595, 0.034989
#*# 	  0.013939, 0.008924, -0.000700, -0.009820, -0.016950, -0.019927, -0.016811, -0.011114, -0.002917, 0.004197, 0.009157, 0.012117, 0.007635, 0.000367, -0.008402, -0.015132, -0.016761, -0.018599, -0.014156, -0.004600, 0.005691, 0.015439, 0.028624, 0.033353, 0.037691
#*# 	  0.014052, 0.012143, 0.001955, -0.008233, -0.015909, -0.019668, -0.019900, -0.013813, -0.005209, 0.004179, 0.007750, 0.010436, 0.006983, -0.000364, -0.008251, -0.014968, -0.017018, -0.016352, -0.015527, -0.009785, 0.003389, 0.011391, 0.023423, 0.033049, 0.037375
#*# 	  0.012495, 0.008945, 0.001433, -0.010615, -0.017591, -0.019795, -0.018875, -0.012775, -0.002334, 0.003407, 0.009122, 0.008783, 0.002308, -0.004779, -0.010770, -0.016894, -0.018318, -0.015706, -0.013302, -0.004711, 0.004675, 0.014723, 0.028120, 0.033819, 0.037417
#*# 	  0.012589, 0.009151, 0.002676, -0.007460, -0.016255, -0.019920, -0.019624, -0.014260, -0.005630, 0.000659, 0.005302, 0.008169, 0.000000, -0.004393, -0.010166, -0.015061, -0.018616, -0.018830, -0.015088, -0.009778, 0.002134, 0.012109, 0.023311, 0.033024, 0.037699
#*# 	  0.006192, 0.005806, -0.001179, -0.011745, -0.021629, -0.024799, -0.021833, -0.014915, -0.005775, 0.000268, 0.004390, 0.003785, -0.004036, -0.006996, -0.015072, -0.015916, -0.019813, -0.019464, -0.015977, -0.007367, 0.004391, 0.011971, 0.025940, 0.032216, 0.037665
#*# 	  0.005203, 0.004760, -0.003548, -0.012717, -0.020231, -0.026149, -0.024894, -0.019997, -0.010368, -0.003002, 0.003488, 0.004312, -0.000506, -0.006527, -0.014524, -0.018417, -0.021233, -0.021426, -0.019932, -0.012496, 0.001268, 0.010039, 0.023640, 0.030879, 0.035912
#*# 	  0.000557, -0.002644, -0.010781, -0.020034, -0.025845, -0.029389, -0.028133, -0.019867, -0.010200, -0.005255, -0.000488, 0.001657, -0.003174, -0.010576, -0.016106, -0.021908, -0.024806, -0.024786, -0.019917, -0.010343, 0.003023, 0.011608, 0.027127, 0.030727, 0.033094
#*# 	  -0.000135, -0.003558, -0.012398, -0.019900, -0.028734, -0.030601, -0.030997, -0.024959, -0.016321, -0.009910, -0.004004, -0.000544, -0.004016, -0.009970, -0.015058, -0.023910, -0.027728, -0.027465, -0.024847, -0.015832, -0.001514, 0.008240, 0.021505, 0.028458, 0.032843
#*# 	  -0.005499, -0.010231, -0.019042, -0.026719, -0.034581, -0.035079, -0.034481, -0.027669, -0.019135, -0.011423, -0.007763, -0.003696, -0.005845, -0.011458, -0.020505, -0.028770, -0.032623, -0.031066, -0.026884, -0.014035, 0.000275, 0.009732, 0.023651, 0.028321, 0.029217
#*# 	  -0.006561, -0.009706, -0.018015, -0.029525, -0.034886, -0.038090, -0.039097, -0.033667, -0.025188, -0.018664, -0.012232, -0.007093, -0.008912, -0.012205, -0.019815, -0.029309, -0.034886, -0.035041, -0.029832, -0.020046, -0.004174, 0.006019, 0.018433, 0.026017, 0.028321
#*# 	  -0.008067, -0.012429, -0.022973, -0.032143, -0.039737, -0.042708, -0.042162, -0.034086, -0.026633, -0.019094, -0.014587, -0.010513, -0.014601, -0.019045, -0.026324, -0.034583, -0.038093, -0.035036, -0.029422, -0.016426, -0.000340, 0.009245, 0.020533, 0.024765, 0.028238
#*# 	  -0.009526, -0.013678, -0.022968, -0.033038, -0.039421, -0.042922, -0.043929, -0.039732, -0.032232, -0.024832, -0.018636, -0.014764, -0.015325, -0.018521, -0.024794, -0.034499, -0.038992, -0.036746, -0.033360, -0.020392, -0.003048, 0.006420, 0.017158, 0.023477, 0.027763
#*# 	  -0.011105, -0.015981, -0.026409, -0.033668, -0.044393, -0.046650, -0.044391, -0.039474, -0.034437, -0.024761, -0.020681, -0.016360, -0.018937, -0.022357, -0.031213, -0.039509, -0.041209, -0.036925, -0.030595, -0.017043, -0.001095, 0.007113, 0.018864, 0.023279, 0.023986
#*# 	  -0.010256, -0.014672, -0.024614, -0.032444, -0.042778, -0.045677, -0.045757, -0.043189, -0.037243, -0.028637, -0.020923, -0.017513, -0.019906, -0.021267, -0.029647, -0.038850, -0.040407, -0.039544, -0.034829, -0.021143, -0.005832, 0.004191, 0.017230, 0.021459, 0.023504
#*# x_count = 25
#*# y_count = 21
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 88.0
#*# max_x = 212.0
#*# min_y = 103.0
#*# max_y = 197.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.776
#*# pid_ki = 1.500
#*# pid_kd = 52.661
#*#
#*# [cartographer model default]
#*# model_coef = 1.5548801632959954,
#*# 	  1.9866308210280872,
#*# 	  0.7374653106730741,
#*# 	  0.3000386180694693,
#*# 	  0.26613442479207033,
#*# 	  0.24676185287368846,
#*# 	  -0.146093936987091,
#*# 	  -0.19216765239118244,
#*# 	  0.14153978967965736,
#*# 	  0.11365561721539494
#*# model_domain = 3.3057004166974394e-07,3.351910151824476e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 26.567250
#*# model_offset = 0.30000
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 36.322
#*# pid_ki = 1.248
#*# pid_kd = 264.240
